"use strict";(self.webpackChunkarmada_alliance_docusaurus=self.webpackChunkarmada_alliance_docusaurus||[]).push([[1214],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return u}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},k=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),k=p(a),u=o,m=k["".concat(s,".").concat(u)]||k[u]||c[u]||r;return a?n.createElement(m,l(l({ref:t},d),{},{components:a})):n.createElement(m,l({ref:t},d))}));function u(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,l=new Array(r);l[0]=k;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var p=2;p<r;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}k.displayName="MDXCreateElement"},9822:function(e,t,a){a.r(t),a.d(t,{assets:function(){return d},contentTitle:function(){return s},default:function(){return u},frontMatter:function(){return i},metadata:function(){return p},toc:function(){return c}});var n=a(7462),o=a(3366),r=(a(7294),a(3905)),l=["components"],i={description:"Create operational keys & certificates. Create wallet & register stake pool"},s="Pi-Core/Cold",p={unversionedId:"stake-pool-guides/pi-pool-tutorial/pi-core-and-pi-cold",id:"stake-pool-guides/pi-pool-tutorial/pi-core-and-pi-cold",title:"Pi-Core/Cold",description:"Create operational keys & certificates. Create wallet & register stake pool",source:"@site/i18n/fi/docusaurus-plugin-content-docs/current/stake-pool-guides/pi-pool-tutorial/pi-core-and-pi-cold.md",sourceDirName:"stake-pool-guides/pi-pool-tutorial",slug:"/stake-pool-guides/pi-pool-tutorial/pi-core-and-pi-cold",permalink:"/armada-alliance-docusaurus/fi/docs/stake-pool-guides/pi-pool-tutorial/pi-core-and-pi-cold",editUrl:"https://github.com/rekuenkdr/armada-alliance-docusaurus/edit/master/docs/stake-pool-guides/pi-pool-tutorial/pi-core-and-pi-cold.md",tags:[],version:"current",frontMatter:{description:"Create operational keys & certificates. Create wallet & register stake pool"}},d={},c=[{value:"Enable blockfetch tracing",id:"enable-blockfetch-tracing",level:3},{value:"Generate Keys &amp; Issue Operational Certificate",id:"generate-keys--issue-operational-certificate",level:2},{value:"Create the pool wallet payment &amp; staking key pairs",id:"create-the-pool-wallet-payment--staking-key-pairs",level:2},{value:"Register the pool \ud83c\udfca",id:"register-the-pool-",level:2},{value:"Confirm successful registration",id:"confirm-successful-registration",level:2},{value:"pool.vet",id:"poolvet",level:3},{value:"adapools.org",id:"adapoolsorg",level:3},{value:"pooltool.io",id:"pooltoolio",level:3},{value:"Backups",id:"backups",level:2}],k={toc:c};function u(e){var t=e.components,i=(0,o.Z)(e,l);return(0,r.kt)("wrapper",(0,n.Z)({},k,i,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"pi-corecold"},"Pi-Core/Cold"),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"You need to have a Pi-Node configured with a new static ip address on your LAN. A fully qualified domain name and cardano-service file set to start on port 3000. You also need to update the env file used by gLiveView.sh located in $NODE_HOME/scripts.")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"You do not enable the topology updater service on a core node so feel free to delete those two scripts and remove the commented out cron job."),(0,r.kt)("p",{parentName:"div"},"Make sure your core node is synced to the tip of the blockchain. :::"))),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://gist.github.com/ilap/3fd57e39520c90f084d25b0ef2b96894"},"https://gist.github.com/ilap/3fd57e39520c90f084d25b0ef2b96894\u200b")),(0,r.kt)("p",null,"Cardano-wallet will not build on arm due to dependency failure. @ZW3RK tried to build it for us and it would not. You may want to install cardano-wallet on an offline x86 machine and go through this process. That is how I did it. You can get cardano-wallet binary below."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://hydra.iohk.io/build/3770189"},"https://hydra.iohk.io/build/3770189")," :::"),(0,r.kt)("h3",{id:"enable-blockfetch-tracing"},"Enable blockfetch tracing"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'sed -i ${NODE_FILES}/${NODE_CONFIG}-config.json \\\n    -e "s/TraceBlockFetchDecisions\\": false/TraceBlockFetchDecisions\\": true/g"\n')),(0,r.kt)("h2",{id:"generate-keys--issue-operational-certificate"},"Generate Keys & Issue Operational Certificate"),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("h4",{parentName:"div",id:"rotating-the-kes-keys"},"Rotating the KES keys"),(0,r.kt)("p",{parentName:"div"},"KES keys need to be regenerated and a new ",(0,r.kt)("strong",{parentName:"p"},"pool.cert")," needs to be issued and submitted to the chain every 90 days. The ",(0,r.kt)("strong",{parentName:"p"},"node.counter")," file keeps track of how many times this has been done. :::"),(0,r.kt)("p",{parentName:"div"},"Generate a KES key pair: ",(0,r.kt)("strong",{parentName:"p"},"kes.vkey")," & ",(0,r.kt)("strong",{parentName:"p"},"kes.skey")),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ${NODE_HOME}\ncardano-cli node key-gen-KES \\\n  --verification-key-file kes.vkey \\\n  --signing-key-file kes.skey\n")),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",{parentName:"div"},"Generate a node cold key pair: ",(0,r.kt)("strong",{parentName:"p"},"node.vkey"),", ",(0,r.kt)("strong",{parentName:"p"},"node.skey")," and ",(0,r.kt)("strong",{parentName:"p"},"node.counter")," file on your Cold Offline machine."),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir ${HOME}/cold-keys\ncd cold-keys\ncardano-cli node key-gen \\\n  --cold-verification-key-file node.vkey \\\n  --cold-signing-key-file node.skey \\\n  --operational-certificate-issue-counter node.counter\n")),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"),(0,r.kt)("h2",{parentName:"div",id:"variables-for-guide-interopability"},"Variables for guide interopability"))),(0,r.kt)("p",null,"The official docs do not do this for some reason and I don't want to write this all out twice. If working through documentation elsewhere please substitute ${NODE_CONFIG} with ${CONFIG_NET} when submitting to the chain on testnet. For mainnet disregard /rant. :::"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"echo export MAGIC=$(cat ${NODE_FILES}/${NODE_CONFIG}-shelley-genesis.json | jq -r '.networkMagic') >> ${HOME}/.adaenv; . ${HOME}/.adaenv\nif [[ ${NODE_CONFIG} = 'testnet' ]]; then echo export CONFIG_NET='testnet-magic\\ ${MAGIC}'; else echo export CONFIG_NET=mainnet; fi >> ${HOME}/.adaenv; . ${HOME}/.adaenv\n")),(0,r.kt)("p",null,"Create variables with the number of slots per KES period from the genesis file and current tip of the chain."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"slotsPerKesPeriod=$(cat ${NODE_FILES}/${NODE_CONFIG}-shelley-genesis.json | jq -r '.slotsPerKESPeriod')\nslotNo=$(cardano-cli query tip --${CONFIG_NET} | jq -r '.slot')\necho slotsPerKesPeriod: ${slotsPerKesPeriod}\necho slotNo: ${slotNo}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Set the ",(0,r.kt)("strong",{parentName:"p"},"startKesPeriod")," variable by dividing ",(0,r.kt)("strong",{parentName:"p"},"slotNo")," / ",(0,r.kt)("strong",{parentName:"p"},"slotsPerKESPeriod"),"."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"startKesPeriod=$((${slotNo} / ${slotsPerKesPeriod}))\necho startKesPeriod: ${startKesPeriod}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Write ",(0,r.kt)("strong",{parentName:"p"},"startKesPeriod")," value down & copy the ",(0,r.kt)("strong",{parentName:"p"},"kes.vkey")," to your cold offline machine."),(0,r.kt)("p",null,"Issue a ",(0,r.kt)("strong",{parentName:"p"},"node.cert")," certificate using: ",(0,r.kt)("strong",{parentName:"p"},"kes.vkey"),", ",(0,r.kt)("strong",{parentName:"p"},"node.skey"),", ",(0,r.kt)("strong",{parentName:"p"},"node.counter")," and ",(0,r.kt)("strong",{parentName:"p"},"startKesPeriod")," value."),(0,r.kt)("p",null,"Replace ",(0,r.kt)("strong",{parentName:"p"},"startKesPeriod")," with the value you wrote down."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli node issue-op-cert \\\n  --kes-verification-key-file kes.vkey \\\n  --cold-signing-key-file ${HOME}/cold-keys/node.skey \\\n  --operational-certificate-issue-counter ${HOME}/cold-keys/node.counter \\\n  --kes-period <startKesPeriod> \\\n  --out-file node.cert\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Copy ",(0,r.kt)("strong",{parentName:"p"},"node.cert")," to your Core machine."),(0,r.kt)("p",null,"Generate a VRF key pair."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli node key-gen-VRF \\\n  --verification-key-file vrf.vkey \\\n  --signing-key-file vrf.skey\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"For security purposes the ",(0,r.kt)("strong",{parentName:"p"},"vrf.skey")," ",(0,r.kt)("strong",{parentName:"p"},"needs")," read only permissions or cardano-node will not start."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"chmod 400 vrf.skey\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Edit the cardano-service startup script by adding ",(0,r.kt)("strong",{parentName:"p"},"kes.skey"),", ",(0,r.kt)("strong",{parentName:"p"},"vrf.skey")," and ",(0,r.kt)("strong",{parentName:"p"},"node.cert")," to the cardano-node run command and changing the port it listens on."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"nano ${HOME}/.local/bin/cardano-service\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"TOPOLOGY=${NODE_FILES}/${NODE_CONFIG}-topology.json\nDB_PATH=${NODE_HOME}/db\nCONFIG=${NODE_FILES}/${NODE_CONFIG}-config.json\nKES=${NODE_HOME}/kes.skey\nVRF=${NODE_HOME}/vrf.skey\nCERT=${NODE_HOME}/node.cert\n## +RTS -N4 -RTS = Multicore(4)\ncardano-node run +RTS -N4 -RTS \\\n  --topology ${TOPOLOGY} \\\n  --database-path ${DB_PATH} \\\n  --socket-path ${CARDANO_NODE_SOCKET_PATH} \\\n  --port ${NODE_PORT} \\\n  --config ${CONFIG} \\\n  --shelley-kes-key ${KES} \\\n  --shelley-vrf-key ${VRF} \\\n  --shelley-operational-certificate ${CERT}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Change the port to 3000 in the .adaenv file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"nano ${HOME}/.adaenv\n. ${HOME}/.adaenv\n")),(0,r.kt)("p",null,"Add your relay(s) to ${NODE_CONFIG}-topolgy.json."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"nano ${NODE_FILES}/${NODE_CONFIG}-topology.json\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Use your LAN IPv4 for addr field if you are not using domain DNS. Be sure to have proper records set with your registrar or DNS service. Below are some examples."),(0,r.kt)("p",null,"Valency greater than one is only used with DNS round robin srv records."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="1 Relay DNS" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "Producers": [\n    {\n      "addr": "r1.example.com",\n      "port": 3001,\n      "valency": 1\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"{% endtab %}"),(0,r.kt)("p",null,'{% tab title="2 Relays DNS" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "Producers": [\n    {\n      "addr": "r1.example.com",\n      "port": 3001,\n      "valency": 1\n    },\n    {\n      "addr": "r2.example.com",\n      "port": 3002,\n      "valency": 1\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"{% endtab %}"),(0,r.kt)("p",null,'{% tab title="1 Relay IPv4" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "Producers": [\n    {\n      "addr": "192.168.1.151",\n      "port": 3001,\n      "valency": 1\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"{% endtab %}"),(0,r.kt)("p",null,'{% tab title="2 Relays IPv4" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "Producers": [\n    {\n      "addr": "192.168.1.151",\n      "port": 3001,\n      "valency": 1\n    },\n    {\n      "addr": "192.168.1.152",\n      "port": 3002,\n      "valency": 1\n    }\n  ]\n}\n')),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Restart and your node is now running as a core."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-service restart\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("h2",{id:"create-the-pool-wallet-payment--staking-key-pairs"},"Create the pool wallet payment & staking key pairs"),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),(0,r.kt)("strong",{parentName:"h5"},"Cold offlline machine.")," Take the time to visualize the operations here.")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("ol",{parentName:"div"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("em",{parentName:"li"},(0,r.kt)("strong",{parentName:"em"},"Generate"))," a wallet key pair named payment. = ",(0,r.kt)("strong",{parentName:"li"},"payment.vkey")," & ",(0,r.kt)("strong",{parentName:"li"},"payment.skey")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("em",{parentName:"li"},(0,r.kt)("strong",{parentName:"em"},"Generate"))," staking key pair. = ",(0,r.kt)("strong",{parentName:"li"},"stake.vkey")," & ",(0,r.kt)("strong",{parentName:"li"},"stake.skey")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("em",{parentName:"li"},(0,r.kt)("strong",{parentName:"em"},"Build"))," a stake address from the newly created ",(0,r.kt)("strong",{parentName:"li"},"stake.vkey"),". = ",(0,r.kt)("strong",{parentName:"li"},"stake.addr")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("em",{parentName:"li"},(0,r.kt)("strong",{parentName:"em"},"Build"))," a wallet address from the ",(0,r.kt)("strong",{parentName:"li"},"payment.vkey")," & delegate with ",(0,r.kt)("strong",{parentName:"li"},"stake.vkey"),". = ",(0,r.kt)("strong",{parentName:"li"},"payment.addr")),(0,r.kt)("li",{parentName:"ol"},"Add funds to the wallet by sending ada to ",(0,r.kt)("strong",{parentName:"li"},"payment.addr")),(0,r.kt)("li",{parentName:"ol"},"Check balance. :::")),(0,r.kt)("h3",{parentName:"div",id:"1-generate-wallet-key-pair"},"1. Generate wallet key pair"),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ${NODE_HOME}\ncardano-cli address key-gen \\\n  --verification-key-file payment.vkey \\\n  --signing-key-file payment.skey\n")),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"),(0,r.kt)("h3",{parentName:"div",id:"2-generate-staking-key-pair"},"2. Generate staking key pair"),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli stake-address key-gen \\\n  --verification-key-file stake.vkey \\\n  --signing-key-file stake.skey\n")),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"),(0,r.kt)("h3",{parentName:"div",id:"3-build-stake-address"},"3. Build stake address"),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli stake-address build \\\n  --stake-verification-key-file stake.vkey \\\n  --out-file stake.addr \\\n  --${CONFIG_NET}\n")),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"),(0,r.kt)("h3",{parentName:"div",id:"4-build-payment-address"},"4. Build payment address"),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli address build \\\n  --payment-verification-key-file payment.vkey \\\n  --stake-verification-key-file stake.vkey \\\n  --out-file payment.addr \\\n  --${CONFIG_NET}\n")),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"),(0,r.kt)("h3",{parentName:"div",id:"5-fund-wallet"},"5. Fund wallet"),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre"},"cat payment.addr\n")),(0,r.kt)("p",{parentName:"div"},"Copy ",(0,r.kt)("strong",{parentName:"p"},"payment.addr")," to a thumb drive and move it to the core nodes pi-pool folder."),(0,r.kt)("p",{parentName:"div"},"Add funds to the wallet. This is the only wallet the pool uses so your pledge goes here as well. There is a 2 ada staking registration fee and a 500 ada pool registration deposit that you can get back when retiring your pool."))),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Core node needs to be synced to the tip of the blockchain. :::")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("h3",{parentName:"div",id:"6-check-balance"},"6. Check balance"),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli query utxo \\\n  --address $(cat payment.addr) \\\n  --${CONFIG_NET}\n")),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"),(0,r.kt)("h2",{parentName:"div",id:"register-stake-address"},"Register stake address"),(0,r.kt)("p",{parentName:"div"},"Issue a staking registration certificate: ",(0,r.kt)("strong",{parentName:"p"},"stake.cert")),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli stake-address registration-certificate \\\n  --stake-verification-key-file stake.vkey \\\n  --out-file stake.cert\n")),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",{parentName:"div"},"Copy ",(0,r.kt)("strong",{parentName:"p"},"stake.cert")," to your core node's pi-pool folder."),(0,r.kt)("p",{parentName:"div"},"Query current slot number or tip of the chain."),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"slotNo=$(cardano-cli query tip --${CONFIG_NET} | jq -r '.slot')\necho slotNo: ${slotNo}\n")),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",{parentName:"div"},"Get the utxo or balance of the wallet."),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'cardano-cli query utxo \\\n  --address $(cat payment.addr) \\\n  --${CONFIG_NET} > fullUtxo.out\n\ntail -n +3 fullUtxo.out | sort -k3 -nr > balance.out\ncat balance.out\ntx_in=""\ntotal_balance=0\n\nwhile read -r utxo; do\n  in_addr=$(awk \'{ print $1 }\' <<< "${utxo}")\n  idx=$(awk \'{ print $2 }\' <<< "${utxo}")\n  utxo_balance=$(awk \'{ print $3 }\' <<< "${utxo}")\n  total_balance=$((${total_balance}+${utxo_balance}))\n  echo TxHash: ${in_addr}#${idx}\n  echo Lovelace: ${utxo_balance}\n  tx_in="${tx_in} --tx-in ${in_addr}#${idx}"\ndone < balance.out\ntxcnt=$(cat balance.out | wc -l)\necho Total ADA balance: $((${total_balance} / 1000000))\necho Number of UTXOs: ${txcnt}\n')),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"))),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"cardano-cli: Network.Socket.connect: : does not exist (No such file or directory)")),(0,r.kt)("p",null,"It is because the core has not finished syncing to the tip of the blockchain. This can take a long time after a reboot. If you look in the db/ folder after cardano-service stop you will see a file named 'clean'. That is confirmation file of a clean database shutdown. It usually takes 5 to 10 minutes to sync back to the tip of the chain on Raspberry Pi as of epoch 267."),(0,r.kt)("p",null,"If however the cardano-node does not shutdown 'cleanly' for whatever reason it can take up to an hour to verify the database(chain) and create the socket file. Socket file is created once your synced. :::"),(0,r.kt)("p",null,"Query --${CONFIG_NET} for protocol parameters."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli query protocol-parameters \\\n  --${CONFIG_NET} \\\n  --out-file params.json\n")),(0,r.kt)("p",null,"Retrieve ",(0,r.kt)("strong",{parentName:"p"},"stakeAddressDeposit")," value from ",(0,r.kt)("strong",{parentName:"p"},"params.json"),"."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"stakeAddressDeposit=$(cat ${NODE_HOME}/params.json | jq -r '.stakeAddressDeposit')\necho stakeAddressDeposit : ${stakeAddressDeposit}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"Stake address registration is 2,000,000 lovelace or 2 ada. :::")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"})),(0,r.kt)("p",null,"Build ",(0,r.kt)("strong",{parentName:"p"},"tx.tmp")," file to hold some information."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli transaction build-raw \\\n  ${tx_in} \\\n  --tx-out $(cat payment.addr)+0 \\\n  --invalid-hereafter $(( ${slotNo} + 1000)) \\\n  --fee 0 \\\n  --certificate stake.cert \\\n  --out-file tx.tmp\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Calculate the minimal fee."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fee=$(cardano-cli transaction calculate-min-fee \\\n  --tx-body-file tx.tmp \\\n  --tx-in-count ${txcnt} \\\n  --tx-out-count 1 \\\n  --${CONFIG_NET} \\\n  --witness-count 2 \\\n  --byron-witness-count 0 \\\n  --protocol-params-file params.json | awk '{ print $1 }')\necho fee: $fee\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Calculate txOut."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"txOut=$((${total_balance}-${stakeAddressDeposit}-${fee}))\necho Change Output: ${txOut}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Build the full transaction to register your staking address."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli transaction build-raw \\\n  ${tx_in} \\\n  --tx-out $(cat payment.addr)+${txOut} \\\n  --invalid-hereafter $(( ${slotNo} + 10000)) \\\n  --fee ${fee} \\\n  --certificate-file stake.cert \\\n  --out-file tx.raw\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Transfer ",(0,r.kt)("strong",{parentName:"p"},"tx.raw")," to your Cold offline machine and sign the transaction with the ",(0,r.kt)("strong",{parentName:"p"},"payment.skey")," and ",(0,r.kt)("strong",{parentName:"p"},"stake.skey"),"."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli transaction sign \\\n  --tx-body-file tx.raw \\\n  --signing-key-file payment.skey \\\n  --signing-key-file stake.skey \\\n  --${CONFIG_NET} \\\n  --out-file tx.signed\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Move ",(0,r.kt)("strong",{parentName:"p"},"tx.signed")," transaction file back to the core nodes pi-pool folder."),(0,r.kt)("p",null,"Submit the transaction to the blockchain."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli transaction submit \\\n  --tx-file tx.signed \\\n  --${CONFIG_NET}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("h2",{id:"register-the-pool-"},"Register the pool \ud83c\udfca"),(0,r.kt)("p",null,"Create a ",(0,r.kt)("strong",{parentName:"p"},"poolMetaData.json")," file. It will contain important information about your pool. You will need to host this file somewhere online forevermore. It must be online and you cannot edit it without resubmitting/updating your pool.cert. In the next couple steps we will hash"),(0,r.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"metadata-url must be less than 64 characters. :::")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},'{% embed url="',(0,r.kt)("a",{parentName:"p",href:"https://pages.github.com/%22"},'https://pages.github.com/"')," %}\nHosting your poolMetaData.json on github is popular choice\n{% endembed %}"),(0,r.kt)("p",{parentName:"div"},"I say host it on your Pi with Nginx."),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ${NODE_HOME}\nnano poolMetaData.json\n")),(0,r.kt)("p",{parentName:"div"},"{% endtab %}\n{% endtabs %}"))),(0,r.kt)("p",null,"Add the following and customize to your metadata."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n"name": "Pool Name",\n"description": "Pool description, no longer than 255 characters.",\n"ticker": "AARCH",\n"homepage": "https://example.com/",\n"extended": "https://example.com/extendedPoolMetaData.json"\n}\n')),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli stake-pool metadata-hash \\\n  --pool-metadata-file poolMetaData.json > poolMetaDataHash.txt\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Copy poolMetaData.json to ",(0,r.kt)("a",{parentName:"p",href:"https://pages.github.io"},"https://pages.github.io")," or host it yourself along with your website. Be careful not to accidentally insert a space or a new line, which would result in a different hash."),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"--metadata-url must be 64 characters or less. :::")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"})),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://adamantium.online/poolMetaData.json"},"https://adamantium.online/poolMetaData.json")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://adamantium.online/extendedPoolMetaData.json"},"https://adamantium.online/extendedPoolMetaData.json\u200b")," :::"),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"minPoolCost=$(cat ${NODE_HOME}/params.json | jq -r .minPoolCost)\necho minPoolCost: ${minPoolCost}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Use the format below to register single or multiple relays."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="DNS Relay(1)" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--single-host-pool-relay <r1.example.com> \\\n--pool-relay-port <R1 NODE PORT> \\\n")),(0,r.kt)("p",null,"{% endtab %}"),(0,r.kt)("p",null,'{% tab title="IPv4 Relay(1)" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--pool-relay-ipv4 <RELAY NODE PUBLIC IP> \\\n--pool-relay-port <R1 NODE PORT> \\\n")),(0,r.kt)("p",null,"{% endtab %}"),(0,r.kt)("p",null,'{% tab title="DNS Relay(2)" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--single-host-pool-relay <r1.example.com> \\\n--pool-relay-port <R1 NODE PORT> \\\n--single-host-pool-relay <r2.example.com> \\\n--pool-relay-port <R2 NODE PORT> \\\n")),(0,r.kt)("p",null,"{% endtab %}"),(0,r.kt)("p",null,'{% tab title="IPv4 Relay(2)" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"--pool-relay-ipv4 <R1 NODE PUBLIC IP> \\\n--pool-relay-port <R1 NODE PORT> \\\n--pool-relay-ipv4 <R2 NODE PUBLIC IP> \\\n--pool-relay-port <R2 NODE PORT> \\\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Edit the information below to match your pools desired configuration. :::")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Copy the vrf.vkey and poolMetaDataHash.txt to your cold machine and issue a stake pool registration certificate. Create a file name registration-cert.txt. Use this file to edit the below command before you issue it. It's also handy to leave this file on the cold machine for any future edits. Below is 1,000 ada pledge, 340 cost and a 1% margin."),(0,r.kt)("p",{parentName:"div"},'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",{parentName:"div"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ${NODE_HOME}\nnano registration-cert.txt\n")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli stake-pool registration-certificate \\\n  --cold-verification-key-file ${HOME}/cold-keys/node.vkey \\\n  --vrf-verification-key-file vrf.vkey \\\n  --pool-pledge 10000000000 \\\n  --pool-cost 340000000 \\\n  --pool-margin 0.01 \\\n  --pool-reward-account-verification-key-file stake.vkey \\\n  --pool-owner-stake-verification-key-file stake.vkey \\\n  --${CONFIG_NET} \\\n  --single-host-pool-relay <r1.example.com> \\\n  --pool-relay-port 3001 \\\n  --metadata-url <https://example.com/poolMetaData.json> \\\n  --metadata-hash $(cat poolMetaDataHash.txt) \\\n  --out-file pool.cert\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Issue a delegation certificate from ",(0,r.kt)("strong",{parentName:"p"},"stake.skey")," & ",(0,r.kt)("strong",{parentName:"p"},"node.vkey"),"."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli stake-address delegation-certificate \\\n  --stake-verification-key-file stake.vkey \\\n  --cold-verification-key-file ${HOME}/cold-keys/node.vkey \\\n  --out-file deleg.cert\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Retrieve your stake pool id."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli stake-pool id --cold-verification-key-file ${HOME}/cold-keys/node.vkey --output-format hex > stakePoolId.txt\ncat stakePoolId.txt\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Move ",(0,r.kt)("strong",{parentName:"p"},"pool.cert"),", ",(0,r.kt)("strong",{parentName:"p"},"deleg.cert")," & ",(0,r.kt)("strong",{parentName:"p"},"stakePoolId.txt")," to your online core machine."),(0,r.kt)("p",null,"Query the current slot number or tip of the chain."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"slotNo=$(cardano-cli query tip --${CONFIG_NET} | jq -r '.slot')\necho slotNo: ${slotNo}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Get the utxo or balance of the wallet."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'cardano-cli query utxo \\\n  --address $(cat payment.addr) \\\n  --${CONFIG_NET} > fullUtxo.out\n\ntail -n +3 fullUtxo.out | sort -k3 -nr > balance.out\ncat balance.out\ntx_in=""\ntotal_balance=0\n\nwhile read -r utxo; do\n  in_addr=$(awk \'{ print $1 }\' <<< "${utxo}")\n  idx=$(awk \'{ print $2 }\' <<< "${utxo}")\n  utxo_balance=$(awk \'{ print $3 }\' <<< "${utxo}")\n  total_balance=$((${total_balance}+${utxo_balance}))\n  echo TxHash: ${in_addr}#${idx}\n  echo Lovelace: ${utxo_balance}\n  tx_in="${tx_in} --tx-in ${in_addr}#${idx}"\ndone < balance.out\ntxcnt=$(cat balance.out | wc -l)\necho Total ADA balance: $((${total_balance} / 1000000))\necho Number of UTXOs: ${txcnt}\n')),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Parse ",(0,r.kt)("strong",{parentName:"p"},"params.json")," for stake pool registration deposit value. Spoiler: it's 500 ada but that could change in the future."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"stakePoolDeposit=$(cat ${NODE_HOME}/params.json | jq -r '.stakePoolDeposit')\necho stakePoolDeposit: ${stakePoolDeposit}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Build temporary ",(0,r.kt)("strong",{parentName:"p"},"tx.tmp")," to hold information while we build our raw transaction file."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli transaction build-raw \\\n  ${tx_in} \\\n  --tx-out $(cat payment.addr)+$(( ${total_balance} - ${stakePoolDeposit}))  \\\n  --invalid-hereafter $(( ${slotNo} + 10000)) \\\n  --fee 0 \\\n  --certificate-file pool.cert \\\n  --certificate-file deleg.cert \\\n  --out-file tx.tmp\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Calculate the transaction fee."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"fee=$(cardano-cli transaction calculate-min-fee \\\n  --tx-body-file tx.tmp \\\n  --tx-in-count ${txcnt} \\\n  --tx-out-count 1 \\\n  --${CONFIG_NET} \\\n  --witness-count 3 \\\n  --byron-witness-count 0 \\\n  --protocol-params-file params.json | awk '{ print $1 }')\n  echo fee: ${fee}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Calculate your change output."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"txOut=$((${total_balance}-${stakePoolDeposit}-${fee}))\necho txOut: ${txOut}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Build your ",(0,r.kt)("strong",{parentName:"p"},"tx.raw")," (unsigned) transaction file."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli transaction build-raw \\\n  ${tx_in} \\\n  --tx-out $(cat payment.addr)+${txOut} \\\n  --invalid-hereafter $(( ${slotNo} + 10000)) \\\n  --fee ${fee} \\\n  --certificate-file pool.cert \\\n  --certificate-file deleg.cert \\\n  --out-file tx.raw\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Move ",(0,r.kt)("strong",{parentName:"p"},"tx.raw")," to your cold offline machine."),(0,r.kt)("p",null,"Sign the transaction with your ",(0,r.kt)("strong",{parentName:"p"},"payment.skey"),", ",(0,r.kt)("strong",{parentName:"p"},"node.skey")," & ",(0,r.kt)("strong",{parentName:"p"},"stake.skey"),"."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Cold Offline" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli transaction sign \\\n  --tx-body-file tx.raw \\\n  --signing-key-file payment.skey \\\n  --signing-key-file ${HOME}/cold-keys/node.skey \\\n  --signing-key-file stake.skey \\\n  --${CONFIG_NET} \\\n  --out-file tx.signed\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("p",null,"Move ",(0,r.kt)("strong",{parentName:"p"},"tx.signed")," back to your core node & submit the transaction to the blockchain."),(0,r.kt)("p",null,'{% tabs %}\n{% tab title="Core" %}'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cardano-cli transaction submit \\\n  --tx-file tx.signed \\\n  --${CONFIG_NET}\n")),(0,r.kt)("p",null,"{% endtab %}\n{% endtabs %}"),(0,r.kt)("h2",{id:"confirm-successful-registration"},"Confirm successful registration"),(0,r.kt)("h3",{id:"poolvet"},"pool.vet"),(0,r.kt)("p",null,"pool.vet is a website for pool operators to check the validity of their stake pools on chain data. You can check this site for problems and clues as to how to fix them."),(0,r.kt)("p",null,'{% embed url="',(0,r.kt)("a",{parentName:"p",href:"https://pool.vet/%22"},'https://pool.vet/"')," %}"),(0,r.kt)("h3",{id:"adapoolsorg"},"adapools.org"),(0,r.kt)("p",null,"You should create an account and claim your pool here."),(0,r.kt)("p",null,'{% embed url="',(0,r.kt)("a",{parentName:"p",href:"https://adapools.org/%22"},'https://adapools.org/"')," %}"),(0,r.kt)("h3",{id:"pooltoolio"},"pooltool.io"),(0,r.kt)("p",null,"You should create an account and claim your pool here."),(0,r.kt)("p",null,'{% embed url="',(0,r.kt)("a",{parentName:"p",href:"https://pooltool.io/%22"},'https://pooltool.io/"')," %}"),(0,r.kt)("h2",{id:"backups"},"Backups"),(0,r.kt)("p",null,"Get a couple small usb sticks and backup all your files and folders(except the db/ folder). Backup your online Core first then the Cold offline files and folders. ",(0,r.kt)("strong",{parentName:"p"},"Do it now"),", not worth the risk! ",(0,r.kt)("strong",{parentName:"p"},"Do not plug the USB stick into anything online after Cold files are on it!")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"https://twitter.com/insaladaPool/status/1380087586509709312?s=19",src:a(7299).Z,width:"598",height:"911"})))}u.isMDXComponent=!0},7299:function(e,t,a){t.Z=a.p+"assets/images/insalada-8e298600620961dd1d14b98a2bdac8ab.png"}}]);