"use strict";(self.webpackChunkarmada_alliance_docusaurus=self.webpackChunkarmada_alliance_docusaurus||[]).push([[8992],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return u}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=p(n),u=r,h=m["".concat(l,".").concat(u)]||m[u]||c[u]||o;return n?a.createElement(h,i(i({ref:t},d),{},{components:n})):a.createElement(h,i({ref:t},d))}));function u(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9553:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return l},default:function(){return u},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return c}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],s={},l="Server Setup",p={unversionedId:"cardano-developer-guides/raspi-node/server-setup",id:"cardano-developer-guides/raspi-node/server-setup",title:"Server Setup",description:"Configure Hardware",source:"@site/docs/cardano-developer-guides/raspi-node/server-setup.md",sourceDirName:"cardano-developer-guides/raspi-node",slug:"/cardano-developer-guides/raspi-node/server-setup",permalink:"/armada-alliance-docusaurus/docs/cardano-developer-guides/raspi-node/server-setup",editUrl:"https://github.com/rekuenkdr/armada-alliance-docusaurus/edit/master/docs/cardano-developer-guides/raspi-node/server-setup.md",tags:[],version:"current",frontMatter:{}},d={},c=[{value:"Configure Hardware",id:"configure-hardware",level:2},{value:"Test drive speed",id:"test-drive-speed",level:3},{value:"Overclock, memory &amp; radios",id:"overclock-memory--radios",level:4},{value:"Configure Raspberry Pi OS",id:"configure-raspberry-pi-os",level:2},{value:"Update The System",id:"update-the-system",level:4},{value:"Disable the Pi user",id:"disable-the-pi-user",level:3},{value:"Disable the root user",id:"disable-the-root-user",level:3},{value:"Secure shared memory",id:"secure-shared-memory",level:3},{value:"Increase open file limit",id:"increase-open-file-limit",level:3},{value:"Optimize performance &amp; security",id:"optimize-performance--security",level:3},{value:"<strong>Load our changes after boot</strong>",id:"load-our-changes-after-boot",level:3},{value:"Disable IRQ balance",id:"disable-irq-balance",level:3},{value:"Chrony",id:"chrony",level:3},{value:"Zram swap",id:"zram-swap",level:3}],m={toc:c};function u(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"server-setup"},"Server Setup"),(0,o.kt)("h2",{id:"configure-hardware"},"Configure Hardware"),(0,o.kt)("p",null,"Let's save some power, raise the governor on the CPU a bit, and set GPU ram as low as we can."),(0,o.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Here are some links for overclocking and testing your drive speeds. If you have heat sinks you can safely go to 2000. Just pay attention to over volt recommendations to go with your chosen clock speed."),(0,o.kt)("ul",{parentName:"div"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.raspberrypi.org/documentation/configuration/config-txt/overclocking.md"},"https://www.raspberrypi.org/documentation/configuration/config-txt/overclocking.md")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.seeedstudio.com/blog/2020/02/12/how-to-safely-overclock-your-raspberry-pi-4-to-2-147ghz/"},"https://www.seeedstudio.com/blog/2020/02/12/how-to-safely-overclock-your-raspberry-pi-4-to-2-147ghz/")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.tomshardware.com/how-to/raspberry-pi-4-23-ghz-overclock"},"https://www.tomshardware.com/how-to/raspberry-pi-4-23-ghz-overclock")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://dopedesi.com/2020/11/24/upgrade-your-raspberry-pi-4-with-a-nvme-boot-drive-by-alex-ellis-nov-2020/"},"https://dopedesi.com/2020/11/24/upgrade-your-raspberry-pi-4-with-a-nvme-boot-drive-by-alex-ellis-nov-2020/")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://jamesachambers.com/new-raspberry-pi-4-bootloader-usb-network-boot-guide/"},"Legendary Technology: New Raspberry Pi 4 Bootloader USB"))))),(0,o.kt)("h3",{id:"test-drive-speed"},"Test drive speed"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Write speed")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo dd if=/dev/zero of=/tmp/output conv=fdatasync bs=384k count=1k; sudo rm -f /tmp/output\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Read speed")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo hdparm -Tt /dev/sda\n")),(0,o.kt)("h4",{id:"overclock-memory--radios"},"Overclock, memory & radios"),(0,o.kt)("p",null,"Edit /boot/firmware/config.txt. Just paste Pi Pool additions in at the bottom."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /boot/config.txt\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"[pi4]\nmax_framebuffers=2\n\n[all]\nkernel=vmlinuz\ncmdline=cmdline.txt\ninitramfs initrd.img followkernel\n\n# Enable the audio output, I2C and SPI interfaces on the GPIO header\ndtparam=audio=on\ndtparam=i2c_arm=on\ndtparam=spi=on\n\n# Enable the serial pins\nenable_uart=1\n\n# Comment out the following line if the edges of the desktop appear outside\n# the edges of your display\ndisable_overscan=1\n\n# If you have issues with audio, you may try uncommenting the following line\n# which forces the HDMI output into HDMI mode instead of DVI (which doesn't\n# support audio output)\n#hdmi_drive=2\n\n# If you have a CM4, uncomment the following line to enable the USB2 outputs\n# on the IO board (assuming your CM4 is plugged into such a board)\n#dtoverlay=dwc2,dr_mode=host\n\n# Config settings specific to arm64\narm_64bit=1\ndtoverlay=dwc2\n\n## Pi Pool ##\nover_voltage=6\narm_freq=2000\n#gpu_mem=16\ndisable-wifi\n#disable-bt\n")),(0,o.kt)("p",null,"Save and reboot."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo reboot\n")),(0,o.kt)("h2",{id:"configure-raspberry-pi-os"},"Configure Raspberry Pi OS"),(0,o.kt)("h4",{id:"update-the-system"},"Update The System"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo apt update && sudo apt upgrade\n")),(0,o.kt)("h3",{id:"disable-the-pi-user"},"Disable the Pi user"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo passwd -l pi\n")),(0,o.kt)("h3",{id:"disable-the-root-user"},"Disable the root user"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo passwd -l root\n")),(0,o.kt)("h3",{id:"secure-shared-memory"},"Secure shared memory"),(0,o.kt)("p",null,"Mount tmpfs as read only."),(0,o.kt)("p",null,"Open /etc/fstab."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo nano /etc/fstab\n")),(0,o.kt)("p",null,"Add this line at the bottom, save & exit."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"tmpfs    /run/shm    tmpfs    ro,noexec,nosuid    0 0\n")),(0,o.kt)("h3",{id:"increase-open-file-limit"},"Increase open file limit"),(0,o.kt)("p",null,"Open /etc/security/limits.conf."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo nano /etc/security/limits.conf\n")),(0,o.kt)("p",null,"Add the following to the bottom, save & exit."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"ada soft nofile 800000\nada hard nofile 1048576\n")),(0,o.kt)("h3",{id:"optimize-performance--security"},"Optimize performance & security"),(0,o.kt)("p",null,"Add the following to the bottom of /etc/sysctl.conf. Save and exit."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("a",{parentName:"p",href:"https://gist.github.com/lokhman/cc716d2e2d373dd696b2d9264c0287a3"},"https://gist.github.com/lokhman/cc716d2e2d373dd696b2d9264c0287a3")))),(0,o.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"I am disabling IPv6 and IPv4 forwarding. You may want these. I have seen claims that IPv6 is slower and gets in the way."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo nano /etc/sysctl.conf\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"## Pi Pool ##\n\n# swap more to zram                     \nvm.vfs_cache_pressure=500\nvm.swappiness=100\nvm.dirty_background_ratio=1\nvm.dirty_ratio=50\n\nfs.file-max = 10000000\nfs.nr_open = 10000000\n\n# enable forwarding if using wireguard\nnet.ipv4.ip_forward=0\n\n# ignore ICMP redirects\nnet.ipv4.conf.all.send_redirects = 0\nnet.ipv4.conf.default.send_redirects = 0\nnet.ipv4.conf.all.accept_redirects = 0\nnet.ipv4.conf.default.accept_redirects = 0\n\nnet.ipv4.icmp_ignore_bogus_error_responses = 1\n\n# disable IPv6\nnet.ipv6.conf.all.disable_ipv6 = 1\nnet.ipv6.conf.default.disable_ipv6 = 1\n\n# block SYN attacks\nnet.ipv4.tcp_syncookies = 1\nnet.ipv4.tcp_max_syn_backlog = 2048\nnet.ipv4.tcp_synack_retries = 3\nnet.ipv4.netfilter.ip_conntrack_tcp_timeout_syn_recv=45\n\n# in progress tasks\nnet.ipv4.tcp_keepalive_time = 240\nnet.ipv4.tcp_keepalive_intvl = 4\nnet.ipv4.tcp_keepalive_probes = 5\n\n# reboot if we run out of memory\nvm.panic_on_oom = 1\nkernel.panic = 10\n\n# Use Google's congestion control algorithm\nnet.core.default_qdisc = fq\nnet.ipv4.tcp_congestion_control = bbr\n")),(0,o.kt)("h3",{id:"load-our-changes-after-boot"},(0,o.kt)("strong",{parentName:"h3"},"Load our changes after boot")),(0,o.kt)("p",null,"Create a new file. Paste, save & close."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo nano /etc/rc.local\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},'#!/bin/sh -e\n#\n# rc.local\n#\n# This script is executed at the end of each multiuser runlevel.\n# Make sure that the script will "exit 0" on success or any other\n# value on error.\n#\n# In order to enable or disable this script just change the execution\n# bits.\n#\n# By default this script does nothing.\n\n# Print the IP address\n_IP=$(hostname -I) || true\nif [ "$_IP" ]; then\n  printf "My IP address is %s\\n" "$_IP"\nfi\n\nsleep 120\n\nsysctl -p /etc/sysctl.conf\n\nexit 0\n')),(0,o.kt)("h3",{id:"disable-irq-balance"},"Disable IRQ balance"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("a",{parentName:"p",href:"http://bookofzeus.com/harden-ubuntu/server-setup/disable-irqbalance/"},(0,o.kt)("strong",{parentName:"a"},"http://bookofzeus.com/harden-ubuntu/server-setup/disable-irqbalance/"))))),(0,o.kt)("p",null,"You should turn off IRQ Balance to make sure you do not get hardware interrupts in your threads. Turning off IRQ Balance will optimize the balance between power savings and performance through the distribution of hardware interrupts across multiple processors."),(0,o.kt)("p",null,"Open /etc/default/irqbalance and add to the bottom. Save, exit and reboot."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo nano /etc/default/irqbalance\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},'ENABLED="0"\n')),(0,o.kt)("h3",{id:"chrony"},"Chrony"),(0,o.kt)("p",null,"We need to get our time synchronization as accurate as possible. Open /etc/chrony/chrony.conf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo apt install chrony\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/chrony/chrony.conf\n")),(0,o.kt)("p",null,"Replace the contents of the file with below, Save and exit."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"pool time.google.com       iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\n#pool time.facebook.com     iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\npool time.euro.apple.com   iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\npool time.apple.com        iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\npool ntp.ubuntu.com        iburst minpoll 2 maxpoll 2 maxsources 3 maxdelay 0.3\n\n# This directive specify the location of the file containing ID/key pairs for\n# NTP authentication.\nkeyfile /etc/chrony/chrony.keys\n\n# This directive specify the file into which chronyd will store the rate\n# information.\ndriftfile /var/lib/chrony/chrony.drift\n\n# Uncomment the following line to turn logging on.\n#log tracking measurements statistics\n\n# Log files location.\nlogdir /var/log/chrony\n\n# Stop bad estimates upsetting machine clock.\nmaxupdateskew 5.0\n\n# This directive enables kernel synchronisation (every 11 minutes) of the\n# real-time clock. Note that it can\u2019t be used along with the 'rtcfile' directive.\nrtcsync\n\n# Step the system clock instead of slewing it if the adjustment is larger than\n# one second, but only in the first three clock updates.\nmakestep 0.1 -1\n\n# Get TAI-UTC offset and leap seconds from the system tz database\nleapsectz right/UTC\n\n# Serve time even if not synchronized to a time source.\nlocal stratum 10\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo service chrony restart\n")),(0,o.kt)("h3",{id:"zram-swap"},"Zram swap"),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"We have found that cardano-node can safely use this compressed swap in ram essentially giving us around 20gb of ram. We already set kernel parameters for zram in /etc/sysctl.conf"))),(0,o.kt)("p",null,"Swapping to disk is slow, swapping to compressed ram space is faster and gives us some overhead before out of memory ","(","oom",")","."),(0,o.kt)("p",null,'{% embed url="',(0,o.kt)("a",{parentName:"p",href:"https://haydenjames.io/raspberry-pi-performance-add-zram-kernel-parameters/%22"},'https://haydenjames.io/raspberry-pi-performance-add-zram-kernel-parameters/"'),' caption="" %}'),(0,o.kt)("p",null,'{% embed url="',(0,o.kt)("a",{parentName:"p",href:"https://lists.ubuntu.com/archives/lubuntu-users/2013-October/005831.html%22"},'https://lists.ubuntu.com/archives/lubuntu-users/2013-October/005831.html"'),' caption="" %}'),(0,o.kt)("p",null,"Disable Raspbian swapfile."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo systemctl disable dphys-swapfile.service\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-text"},"sudo apt install zram-tools\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/default/zramswap\n")),(0,o.kt)("p",null,"Multiply default config by 3. This will give you 12.5GB of virtual compressed swap in ram."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"mem=$","(","(","(","totalmem / 2 / ${NRDEVICES}",")"," ","*"," 1024 ","*"," 3",")",")"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/sh\n# load dependency modules\nNRDEVICES=$(grep -c ^processor /proc/cpuinfo | sed 's/^0$/1/')\nif modinfo zram | grep -q ' zram_num_devices:' 2>/dev/null; then\n  MODPROBE_ARGS=\"zram_num_devices=${NRDEVICES}\"\nelif modinfo zram | grep -q ' num_devices:' 2>/dev/null; then\n  MODPROBE_ARGS=\"num_devices=${NRDEVICES}\"\nelse\n  exit 1\nfi\nmodprobe zram $MODPROBE_ARGS\n# Calculate memory to use for zram (1/2 of ram)\ntotalmem=`LC_ALL=C free | grep -e \"^Mem:\" | sed -e 's/^Mem: *//' -e 's/  *.*//'`\nmem=$(((totalmem / 2 / ${NRDEVICES}) * 1024 * 3))\n# initialize the devices\nfor i in $(seq ${NRDEVICES}); do\n  DEVNUMBER=$((i - 1))\n  echo zstd > /sys/block/zram${DEVNUMBER}/comp_algorithm\n  echo $mem > /sys/block/zram${DEVNUMBER}/disksize\n  mkswap /dev/zram${DEVNUMBER}\n  swapon -p 5 /dev/zram${DEVNUMBER}\ndone\n")),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"View how much zram swap cardano-node is using."),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-text"},"CNZRAM=$(pidof cardano-node)\ngrep --color VmSwap /proc/$CNZRAM/status\n")))))}u.isMDXComponent=!0}}]);